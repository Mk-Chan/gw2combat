{
    "title": "Encounter",
    "type": "object",
    "properties": {
        "actors": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/actor"
            }
        },
        "termination_conditions": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/termination_condition"
            }
        },
        "audit_configuration": {
            "type": "object",
            "properties": {
                "audits_to_perform": {
                    "type": "array",
                    "items": {
                        "type": "string",
                        "enum": [
                            "ACTOR_CREATED",
                            "SKILL_CASTS",
                            "BUNDLES",
                            "EFFECT_APPLICATIONS",
                            "DAMAGE",
                            "COMBAT_STATS",
                            "EFFECT_EXPIRATION",
                            "ACTOR_DOWNSTATE"
                        ]
                    },
                    "default": [
                        "ACTOR_CREATED",
                        "SKILL_CASTS",
                        "BUNDLES",
                        "EFFECT_APPLICATIONS",
                        "DAMAGE",
                        "COMBAT_STATS",
                        "EFFECT_EXPIRATION",
                        "ACTOR_DOWNSTATE"
                    ]
                }
            }
        },
        "require_afk_skills": {
            "type": "boolean",
            "default": false
        },
        "audit_offset": {
            "type": "integer",
            "default": 0,
            "description": "Offset in number of events to start the audit from. Useful for reducing the size of the audit JSON for network transfer."
        },
        "weapon_strength_mode": {
            "type": "string",
            "enum": [
                "MEAN",
                "RANDOM",
                "LOWEST",
                "HIGHEST"
            ],
            "default": "MEAN"
        },
        "enable_caching": {
            "type": "boolean",
            "default": true
        }
    },
    "required": ["actors", "termination_conditions"],
    "definitions": {
        "attribute": {
            "type": "string",
            "enum": [
                "power",
                "precision",
                "toughness",
                "vitality",
                "concentration",
                "condition_damage",
                "expertise",
                "ferocity",
                "healing_power",
                "armor",
                "max_health",
                "critical_chance_multiplier",
                "critical_damage_multiplier",
                "boon_duration_multiplier",
                "aegis_duration_multiplier",
                "alacrity_duration_multiplier",
                "fury_duration_multiplier",
                "might_duration_multiplier",
                "protection_duration_multiplier",
                "quickness_duration_multiplier",
                "regeneration_duration_multiplier",
                "resistance_duration_multiplier",
                "resolution_duration_multiplier",
                "stability_duration_multiplier",
                "swiftness_duration_multiplier",
                "vigor_duration_multiplier",
                "condition_duration_multiplier",
                "burning_duration_multiplier",
                "bleeding_duration_multiplier",
                "confusion_duration_multiplier",
                "poison_duration_multiplier",
                "torment_duration_multiplier",
                "condition_damage_multiplier",
                "burning_damage_multiplier",
                "bleeding_damage_multiplier",
                "confusion_damage_multiplier",
                "poison_damage_multiplier",
                "torment_damage_multiplier",
                "outgoing_strike_damage_multiplier",
                "outgoing_strike_damage_multiplier_add_group",
                "incoming_strike_damage_multiplier",
                "incoming_strike_damage_multiplier_add_group",
                "outgoing_condition_damage_multiplier",
                "outgoing_condition_damage_multiplier_add_group",
                "incoming_condition_damage_multiplier",
                "incoming_condition_damage_multiplier_add_group"
            ]
        },
        "actor": {
            "type": "object",
            "properties": {
                "name": {
                    "type": "string"
                },
                "build": {
                    "$ref": "#/definitions/build"
                },
                "rotation": {
                    "$ref": "#/definitions/rotation"
                },
                "team": {
                    "type": "integer"
                },
                "audit_base_path": {
                    "type": "string"
                }
            },
            "required": ["name", "build", "team"]
        },
        "build": {
            "type": "object",
            "properties": {
                "attributes": {
                    "type": "array",
                    "items": {
                        "type": "array",
                        "description": "First item is attribute name and second item is value.",
                        "items": {
                            "oneOf": [
                                {
                                    "$ref": "#/definitions/attribute"
                                },
                                {
                                    "type": "integer"
                                }
                            ]
                        },
                        "minItems": 2,
                        "maxItems": 2
                    }
                },
                "weapons": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/weapon"
                    }
                },
                "initial_weapon_set": {
                    "$ref": "#/definitions/weapon_set"
                },
                "skills": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/skill"
                    }
                },
                "conditional_skill_groups": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/conditional_skill_group"
                    }
                },
                "permanent_effects": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/effect"
                    }
                },
                "permanent_unique_effects": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/unique_effect"
                    }
                },
                "counters": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/counter_configuration"
                    }
                },
                "recipes": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/recipe"
                    }
                },
                "recipe_paths": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                }
            },
            "required": ["attributes"]
        },
        "recipe": {
            "type": "object",
            "properties": {
                "counters": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/counter_configuration"
                    }
                },
                "permanent_effects": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/effect"
                    }
                },
                "permanent_unique_effects": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/unique_effect"
                    }
                },
                "skills": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/skill"
                    }
                },
                "conditional_skill_groups": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/conditional_skill_group"
                    }
                }
            }
        },
        "counter_configuration": {
            "type": "object",
            "properties": {
                "counter_key": {
                    "type": "string"
                },
                "initial_value": {
                    "type": "integer",
                    "default": 0
                },
                "counter_modifiers": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/counter_modifier"
                    },
                    "minItems": 1
                }
            },
            "required": ["counter_key", "initial_value", "counter_modifiers"]
        },
        "rotation": {
            "type": "object",
            "properties": {
                "skill_casts": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/skill_cast"
                    }
                },
                "repeat": {
                    "type": "boolean"
                }
            },
            "required": ["skill_casts"]
        },
        "skill_cast": {
            "type": "object",
            "properties": {
                "skill": {
                    "type": "string"
                },
                "cast_time_ms": {
                    "type": "integer",
                    "default": 0
                }
            },
            "required": ["skill"]
        },
        "weapon": {
            "type": "object",
            "properties": {
                "type": {
                    "$ref": "#/definitions/weapon_type"
                },
                "position": {
                    "$ref": "#/definitions/weapon_position"
                },
                "set": {
                    "$ref": "#/definitions/weapon_set"
                }
            },
            "required": ["type", "position", "set"]
        },
        "weapon_type": {
            "type": "string",
            "enum": [
                "main_hand",
                "empty_handed",
                "greatsword",
                "longbow",
                "sword",
                "axe",
                "torch",
                "scepter",
                "focus",
                "kit_conjure",
                "tome",
                "dagger",
                "mace",
                "pistol",
                "shield",
                "warhorn",
                "hammer",
                "rifle",
                "shortbow",
                "staff",
                "aquatic",
                "spear"
            ]
        },
        "weapon_position": {
            "type": "string",
            "enum": [
                "universal",
                "main_hand",
                "off_hand",
                "two_handed"
            ]
        },
        "weapon_set": {
            "type": "string",
            "enum": [
                "set_1",
                "set_2"
            ]
        },
        "skill": {
            "type": "object",
            "properties": {
                "skill_key": {
                    "type": "string"
                },
                "weapon_type": {
                    "$ref": "#/definitions/weapon_type"
                },
                "required_bundle": {
                    "type": "string"
                },
                "attribute_damage_to_skill": {
                    "type": "string"
                },
                "cast_duration": {
                    "type": "array",
                    "description": "First item is base cast time and second item is with quickness.",
                    "items": {
                        "type": "integer"
                    },
                    "minItems": 2,
                    "maxItems": 2
                },
                "cooldown": {
                    "type": "array",
                    "description": "First item is base cooldown and second item is with alacrity.",
                    "items": {
                        "type": "integer"
                    },
                    "minItems": 2,
                    "maxItems": 2
                },
                "flat_damage": {
                    "type": "number"
                },
                "damage_coefficient": {
                    "type": "number"
                },
                "ammo": {
                    "type": "integer"
                },
                "num_targets": {
                    "type": "integer"
                },
                "strike_on_tick_list": {
                    "type": "array",
                    "items": {
                        "type": "array",
                        "description": "First item is base tick list and second item is with quickness.",
                        "items": {
                            "type": "integer"
                        },
                        "minItems": 1
                    },
                    "minItems": 2,
                    "maxItems": 2
                },
                "pulse_on_tick_list": {
                    "type": "array",
                    "items": {
                        "type": "array",
                        "description": "First item is base tick list and second item is with quickness.",
                        "items": {
                            "type": "integer"
                        },
                        "minItems": 1
                    },
                    "minItems": 2,
                    "maxItems": 2
                },
                "on_strike_effect_applications": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/effect_application"
                    }
                },
                "on_pulse_effect_applications": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/effect_application"
                    }
                },
                "attribute_modifiers": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/attribute_modifier"
                    }
                },
                "attribute_conversions": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/attribute_conversion"
                    }
                },
                "counter_modifiers": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/counter_modifier"
                    }
                },
                "skill_triggers": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/skill_trigger"
                    }
                },
                "unchained_skill_triggers": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/skill_trigger"
                    }
                },
                "source_actor_skill_triggers": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/skill_trigger"
                    }
                },
                "effect_removals": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/effect_removal"
                    }
                },
                "cooldown_modifiers": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/cooldown_modifier"
                    }
                },
                "skills_to_put_on_cooldown": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "skills_to_cancel": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "child_skill_keys": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "tags": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "combo_field": {
                    "$ref": "#/definitions/combo_field"
                },
                "whirl_finisher_on_tick_list": {
                    "type": "array",
                    "items": {
                        "type": "array",
                        "description": "First item is base tick list and second item is with quickness.",
                        "items": {
                            "type": "integer"
                        },
                        "minItems": 1
                    },
                    "minItems": 2,
                    "maxItems": 2
                },
                "can_critical_strike": {
                    "type": "boolean",
                    "default": "true"
                },
                "equip_bundle": {
                    "type": "string",
                    "description": "Bundle to equip after casting this skill."
                },
                "drop_bundle": {
                    "type": "string",
                    "description": "Bundle to remove after casting this skill."
                },
                "instant_cast_only_when_not_in_animation": {
                    "type": "boolean",
                    "default": false,
                    "description": "If true and the skill is actually an instant cast skill, it will execute after any existing animation as opposed to the default behavior of executing immediately off cooldown regardless of animation."
                },
                "executable": {
                    "type": "boolean",
                    "default": false,
                    "description": "If true, this skill will be scanned for castability in the audit report."
                },
                "cast_condition": {
                    "$ref": "#/definitions/condition"
                }
            },
            "required": ["skill_key"]
        },
        "conditional_skill_group": {
            "type": "object",
            "properties": {
                "skill_key": {
                    "type": "string"
                },
                "conditional_skill_keys": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/conditional_skill"
                    },
                    "minItems": 1
                }
            },
            "required": ["skill_key", "conditional_skill_keys"]
        },
        "conditional_skill": {
            "type": "object",
            "properties": {
                "condition": {
                    "$ref": "#/definitions/condition"
                },
                "skill_key": {
                    "type": "string"
                }
            },
            "required": ["condition", "skill_key"]
        },
        "combo_field": {
            "type": "string",
            "enum": [
                "dark",
                "ethereal",
                "fire",
                "ice",
                "light",
                "lightning",
                "poison",
                "smoke",
                "water"
            ]
        },
        "effect_application": {
            "type": "object",
            "properties": {
                "condition": {
                    "$ref": "#/definitions/condition"
                },
                "effect": {
                    "$ref": "#/definitions/effect"
                },
                "unique_effect": {
                    "$ref": "#/definitions/unique_effect"
                },
                "direction": {
                    "$ref": "#/definitions/direction"
                },
                "base_duration_ms": {
                    "type": "integer",
                    "default": 0
                },
                "num_stacks": {
                    "type": "integer",
                    "default": 1
                },
                "num_targets": {
                    "type": "integer",
                    "default": 1
                }
            },
            "anyOf": [
                {
                    "required": ["direction", "effect"]
                },
                {
                    "required": ["direction", "unique_effect"]
                }
            ]
        },
        "direction": {
            "type": "string",
            "enum": [
                "SELF",
                "TEAM",
                "OUTGOING"
            ]
        },
        "condition": {
            "type": "object",
            "properties": {
                "weapon_type": {
                    "$ref": "#/definitions/weapon_type"
                },
                "weapon_position": {
                    "$ref": "#/definitions/weapon_position"
                },
                "weapon_set": {
                    "$ref": "#/definitions/weapon_set"
                },
                "bundle": {
                    "type": "string"
                },
                "unique_effect_on_source": {
                    "type": "string"
                },
                "effect_on_source": {
                    "$ref": "#/definitions/effect"
                },
                "unique_effect_on_target": {
                    "type": "string"
                },
                "unique_effect_on_target_by_source": {
                    "type": "string"
                },
                "effect_on_target": {
                    "$ref": "#/definitions/effect"
                },
                "stacks_of_effect_on_target": {
                    "type": "integer"
                },
                "depends_on_skill_off_cooldown": {
                    "type": "string"
                },
                "threshold": {
                    "$ref": "#/definitions/threshold"
                },
                "not": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/condition"
                    }
                },
                "or": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/condition"
                    }
                },
                "and": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/condition"
                    }
                },
                "only_applies_on_strikes": {
                    "type": "boolean",
                    "default": false
                },
                "only_applies_on_critical_strikes": {
                    "type": "boolean",
                    "default": false
                },
                "only_applies_on_strikes_by_skill": {
                    "type": "string"
                },
                "only_applies_on_strikes_by_skill_with_tag": {
                    "type": "string"
                },
                "only_applies_on_effect_application": {
                    "type": "boolean",
                    "default": false
                },
                "only_applies_on_effect_application_of_type": {
                    "$ref": "#/definitions/effect"
                },
                "only_applies_on_begun_casting": {
                    "type": "boolean",
                    "default": false
                },
                "only_applies_on_begun_casting_skill": {
                    "type": "string"
                },
                "only_applies_on_begun_casting_skill_with_tag": {
                    "type": "string"
                },
                "only_applies_on_finished_casting": {
                    "type": "boolean",
                    "default": false
                },
                "only_applies_on_finished_casting_skill": {
                    "type": "string"
                },
                "only_applies_on_finished_casting_skill_with_tag": {
                    "type": "string"
                },
                "only_applies_on_ammo_gain_of_skill": {
                    "type": "string"
                }
            }
        },
        "threshold": {
            "type": "object",
            "properties": {
                "threshold_type": {
                    "type": "string",
                    "enum": [
                        "equal",
                        "upper_bound_exclusive",
                        "upper_bound_inclusive",
                        "lower_bound_exclusive",
                        "lower_bound_inclusive"
                    ]
                },
                "threshold_value": {
                    "type": "number"
                },
                "generate_random_number_subject_to_threshold": {
                    "type": "boolean",
                    "description": "If true, threshold_value is interpreted as a random number between 0.0 and 100.0 inclusive."
                },
                "health_pct_subject_to_threshold": {
                    "type": "boolean",
                    "description": "If true, threshold_value is interpreted as a percentage of max health."
                },
                "counter_value_subject_to_threshold": {
                    "type": "string",
                    "description": "Name of the counter to use as the value."
                }
            }
        },
        "effect": {
            "type": "string",
            "enum": [
                "AEGIS",
                "ALACRITY",
                "FURY",
                "MIGHT",
                "QUICKNESS",
                "RESOLUTION",
                "RESISTANCE",
                "PROTECTION",
                "REGENERATION",
                "VIGOR",
                "SWIFTNESS",
                "STABILITY",
                "BLINDED",
                "CHILLED",
                "CRIPPLED",
                "FEAR",
                "IMMOBILIZED",
                "SLOW",
                "TAUNT",
                "WEAKNESS",
                "VULNERABILITY",
                "BURNING",
                "BLEEDING",
                "TORMENT",
                "POISON",
                "CONFUSION",
                "BINDING_BLADE"
            ]
        },
        "unique_effect": {
            "type": "object",
            "properties": {
                "unique_effect_key": {
                    "type": "string"
                },
                "attribute_modifiers": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/attribute_modifier"
                    }
                },
                "attribute_conversions": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/attribute_conversion"
                    }
                },
                "counter_modifiers": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/counter_modifier"
                    }
                },
                "skill_triggers": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/skill_trigger"
                    }
                },
                "unchained_skill_triggers": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/skill_trigger"
                    }
                },
                "source_actor_skill_triggers": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/skill_trigger"
                    }
                },
                "effect_removals": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/effect_removal"
                    }
                },
                "cooldown_modifiers": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/cooldown_modifier"
                    }
                },
                "max_considered_stacks": {
                    "type": "integer",
                    "default": 1
                },
                "max_stored_stacks": {
                    "type": "integer",
                    "default": 1500
                },
                "max_duration": {
                    "type": "integer",
                    "default": 30000
                },
                "stacking_type": {
                    "$ref": "#/definitions/stacking_type"
                },
                "refreshes_other_stacks": {
                    "type": "boolean",
                    "default": false
                }
            },
            "required": ["unique_effect_key"]
        },
        "attribute_modifier": {
            "type": "object",
            "properties": {
                "condition": {
                    "$ref": "#/definitions/condition"
                },
                "attribute": {
                    "$ref": "#/definitions/attribute"
                },
                "multiplier": {
                    "type": "number",
                    "default": 1.0
                },
                "addend": {
                    "type": "number",
                    "default": 0.0
                }
            }
        },
        "attribute_conversion": {
            "condition": {
                "$ref": "#/definitions/condition"
            },
            "from": {
                "$ref": "#/definitions/attribute"
            },
            "to": {
                "$ref": "#/definitions/attribute"
            },
            "multiplier": {
                "type": "number",
                "default": 1.0
            },
            "addend": {
                "type": "number",
                "default": 0.0
            }
        },
        "counter_modifier": {
            "type": "object",
            "properties": {
                "condition": {
                    "$ref": "#/definitions/condition"
                },
                "counter_key": {
                    "type": "string"
                },
                "operation": {
                    "type": "string",
                    "enum": [
                        "add",
                        "subtract",
                        "set",
                        "reset"
                    ]
                },
                "value": {
                    "type": "integer"
                },
                "counter_value": {
                    "type": "string",
                    "description": "Name of the counter to use as the value."
                }
            },
            "oneOf": [
                {
                    "required": ["counter_key", "operation", "value"]
                },
                {
                    "required": ["counter_key", "operation", "counter_value"]
                }
            ]
        },
        "skill_trigger": {
            "type": "object",
            "properties": {
                "condition": {
                    "$ref": "#/definitions/condition"
                },
                "skill_key": {
                    "type": "string"
                }
            },
            "required": ["skill_key"]
        },
        "effect_removal": {
            "type": "object",
            "properties": {
                "condition": {
                    "$ref": "#/definitions/condition"
                },
                "effect": {
                    "$ref": "#/definitions/effect"
                },
                "unique_effect": {
                    "type": "string"
                },
                "num_stacks": {
                    "type": "integer",
                    "description": "Number of stacks to remove. If not specified, all stacks are removed."
                }
            },
            "anyOf": [
                {
                    "required": ["effect"]
                },
                {
                    "required": ["unique_effect"]
                }
            ]
        },
        "cooldown_modifier": {
            "type": "object",
            "properties": {
                "condition": {
                    "$ref": "#/definitions/condition"
                },
                "skill_key": {
                    "type": "string"
                },
                "operation": {
                    "type": "string",
                    "enum": [
                        "add",
                        "subtract",
                        "set",
                        "reset"
                    ]
                },
                "value": {
                    "type": "integer"
                }
            }
        },
        "stacking_type": {
            "type": "string",
            "enum": [
                "intensity",
                "duration",
                "replace"
            ]
        },
        "termination_condition": {
            "type": "object",
            "properties": {
                "type": {
                    "type": "string",
                    "enum": [
                        "TIME",
                        "ROTATION",
                        "DAMAGE"
                    ]
                },
                "time": {
                    "type": "integer",
                    "description": "Terminate the encounter after this many milliseconds."
                },
                "actor": {
                    "type": "string",
                    "description": "Terminate the encounter after this actor has completed its rotation."
                },
                "damage": {
                    "type": "integer",
                    "description": "Terminate the encounter after this much damage has been dealt to the actor specified in the 'actor' field."
                }
            },
            "anyOf": [
                {
                    "required": ["type", "time"]
                },
                {
                    "required": ["type", "actor"]
                },
                {
                    "required": ["type", "actor", "damage"]
                }
            ]
        }
    }
}
